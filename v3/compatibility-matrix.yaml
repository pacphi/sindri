# Sindri CLI Compatibility Matrix
# This file defines which extension versions are compatible with each CLI version
# and documents breaking changes between versions.
#
# Schema Version: 1.0
# Last Updated: 2026-01-28

schema_version: "1.0"

# CLI version compatibility mappings
# Key format: CLI version (supports wildcards like "3.0.x")
# Compatible extension versions use semver ranges (e.g., ">=1.0.0,<2.0.0")
cli_versions:
  # CLI v3.0.x series (initial Rust release)
  "3.0.x":
    # Extension schema version compatibility
    extension_schema: "1.0"

    # Compatible extension version ranges
    # Format: extension_name: "semver_range"
    compatible_extensions:
      # Core extensions (always installed)
      mise-config: ">=2.0.0,<3.0.0"

      # Language extensions
      python: ">=1.0.0,<2.0.0"
      nodejs: ">=1.1.0,<2.0.0"
      rust: ">=1.0.0,<2.0.0"
      golang: ">=1.0.1,<2.0.0"
      sdkman: ">=1.0.0,<2.0.0"
      jvm: ">=2.0.0,<3.0.0"
      dotnet: ">=2.1.0,<3.0.0"
      php: ">=2.1.0,<3.0.0"
      ruby: ">=2.0.0,<3.0.0"
      haskell: ">=1.0.1,<2.0.0"

      # AI & Agentic Tools
      agent-browser: ">=0.6.0,<1.0.0"
      agent-manager: ">=2.0.0,<3.0.0"
      agentic-flow: ">=1.0.0,<2.0.0"
      agentic-qe: ">=1.1.0,<2.0.0"
      ai-toolkit: ">=2.1.0,<3.0.0"

      # Claude Ecosystem
      claude-code-mux: ">=1.0.0,<2.0.0"
      claude-codepro: ">=4.5.0,<5.0.0"
      claude-flow-v2: ">=2.7.0,<3.0.0"
      claude-flow-v3: ">=3.0.0,<4.0.0"
      claude-marketplace: ">=2.0.0,<3.0.0"
      claudeup: ">=1.0.0,<2.0.0"
      claudish: ">=1.0.0,<2.0.0"
      compahook: ">=1.0.0,<2.0.0"

      # Cloud & Infrastructure
      cloud-tools: ">=2.0.0,<3.0.0"
      infra-tools: ">=2.0.0,<3.0.0"
      monitoring: ">=2.0.0,<3.0.0"

      # DevOps & Tools
      docker: ">=1.1.0,<2.0.0"
      github-cli: ">=2.0.0,<3.0.0"
      supabase-cli: ">=2.0.0,<3.0.0"
      tmux-workspace: ">=2.0.0,<3.0.0"

      # MCP Servers
      context7-mcp: ">=1.0.0,<2.0.0"
      excalidraw-mcp: ">=1.0.0,<2.0.0"
      jira-mcp: ">=2.0.0,<3.0.0"
      linear-mcp: ">=2.1.0,<3.0.0"
      pal-mcp-server: ">=9.8.0,<10.0.0"

      # Development Tools
      nodejs-devtools: ">=2.2.0,<3.0.0"

      # AI/ML Tools
      goose: ">=1.0.0,<2.0.0"
      ollama: ">=1.0.0,<2.0.0"

      # Desktop & UI
      guacamole: ">=2.0.0,<3.0.0"
      xfce-ubuntu: ">=2.0.0,<3.0.0"

      # Testing
      playwright: ">=2.0.0,<3.0.0"

      # Documentation & Content
      mdflow: ">=1.0.0,<2.0.0"
      spec-kit: ">=1.0.0,<2.0.0"

      # Productivity
      openskills: ">=2.0.0,<3.0.0"
      ralph: ">=1.0.0,<2.0.0"
      ruvnet-research: ">=1.0.0,<2.0.0"

    # Breaking changes introduced in this version
    breaking_changes:
      - "CLI rewritten in Rust - bash-based extensions from v2.x are not compatible"
      - "Extension schema updated to v1.0 with new validation requirements"
      - "Manifest file format changed from v2.x - automatic migration required"
      - "Extension install methods standardized (mise, apt, binary, npm, script, hybrid)"
      - "Removed deprecated 'manual' install method - use 'script' instead"
      - "Extension hooks now support pre/post install lifecycle events"
      - "Fixed naming: 'java' → 'jvm', 'go' → 'golang' for consistency"
      - "Removed phantom extensions that don't exist in v3"
      - "Added 39 missing extensions to compatibility matrix"

  # CLI v3.1.x series (planned enhancements)
  "3.1.x":
    extension_schema: "1.1"

    compatible_extensions:
      # Core extensions
      mise-config: ">=2.1.0,<3.0.0"

      # Language extensions (updated for new features)
      python: ">=1.1.0,<2.0.0"
      nodejs: ">=1.2.0,<2.0.0"
      rust: ">=1.1.0,<2.0.0"
      golang: ">=1.1.0,<2.0.0"
      sdkman: ">=1.1.0,<2.0.0"
      jvm: ">=2.1.0,<3.0.0"
      dotnet: ">=2.2.0,<3.0.0"
      php: ">=2.2.0,<3.0.0"
      ruby: ">=2.1.0,<3.0.0"
      haskell: ">=1.1.0,<2.0.0"

      # AI & Agentic Tools
      agent-browser: ">=0.7.0,<1.0.0"
      agent-manager: ">=2.1.0,<3.0.0"
      agentic-flow: ">=1.1.0,<2.0.0"
      agentic-qe: ">=1.2.0,<2.0.0"
      ai-toolkit: ">=2.2.0,<3.0.0"

      # Claude Ecosystem
      claude-code-mux: ">=1.1.0,<2.0.0"
      claude-codepro: ">=4.6.0,<5.0.0"
      claude-flow-v2: ">=2.8.0,<3.0.0"
      claude-flow-v3: ">=3.1.0,<4.0.0"
      claude-marketplace: ">=2.1.0,<3.0.0"
      claudeup: ">=1.1.0,<2.0.0"
      claudish: ">=1.1.0,<2.0.0"
      compahook: ">=1.1.0,<2.0.0"

      # Cloud & Infrastructure
      cloud-tools: ">=2.1.0,<3.0.0"
      infra-tools: ">=2.1.0,<3.0.0"
      monitoring: ">=2.1.0,<3.0.0"

      # DevOps & Tools
      docker: ">=1.2.0,<2.0.0"
      github-cli: ">=2.1.0,<3.0.0"
      supabase-cli: ">=2.1.0,<3.0.0"
      tmux-workspace: ">=2.1.0,<3.0.0"

      # MCP Servers
      context7-mcp: ">=1.1.0,<2.0.0"
      excalidraw-mcp: ">=1.1.0,<2.0.0"
      jira-mcp: ">=2.1.0,<3.0.0"
      linear-mcp: ">=2.2.0,<3.0.0"
      pal-mcp-server: ">=9.9.0,<10.0.0"

      # Development Tools
      nodejs-devtools: ">=2.3.0,<3.0.0"

      # AI/ML Tools
      goose: ">=1.1.0,<2.0.0"
      ollama: ">=1.1.0,<2.0.0"

      # Desktop & UI
      guacamole: ">=2.1.0,<3.0.0"
      xfce-ubuntu: ">=2.1.0,<3.0.0"

      # Testing
      playwright: ">=2.1.0,<3.0.0"

      # Documentation & Content
      mdflow: ">=1.1.0,<2.0.0"
      spec-kit: ">=1.1.0,<2.0.0"

      # Productivity
      openskills: ">=2.1.0,<3.0.0"
      ralph: ">=1.1.0,<2.0.0"
      ruvnet-research: ">=1.1.0,<2.0.0"

    breaking_changes:
      - "Extension schema v1.1 adds support for conditional dependencies"
      - "New authentication capability system for extensions"
      - "MCP integration now requires explicit registration"

  # CLI v4.0.x series (future major version - placeholder)
  "4.0.x":
    extension_schema: "2.0"

    compatible_extensions:
      mise-config: ">=3.0.0,<4.0.0"
      python: ">=2.0.0,<3.0.0"
      nodejs: ">=2.0.0,<3.0.0"
      rust: ">=2.0.0,<3.0.0"
      golang: ">=2.0.0,<3.0.0"
      sdkman: ">=2.0.0,<3.0.0"
      jvm: ">=3.0.0,<4.0.0"
      dotnet: ">=3.0.0,<4.0.0"
      php: ">=3.0.0,<4.0.0"
      ruby: ">=3.0.0,<4.0.0"
      haskell: ">=2.0.0,<3.0.0"

      # AI & Agentic Tools
      agent-browser: ">=1.0.0,<2.0.0"
      agent-manager: ">=3.0.0,<4.0.0"
      agentic-flow: ">=2.0.0,<3.0.0"
      agentic-qe: ">=2.0.0,<3.0.0"
      ai-toolkit: ">=3.0.0,<4.0.0"

      # Claude Ecosystem
      claude-code-mux: ">=2.0.0,<3.0.0"
      claude-codepro: ">=5.0.0,<6.0.0"
      claude-flow-v2: ">=3.0.0,<4.0.0"
      claude-flow-v3: ">=4.0.0,<5.0.0"
      claude-marketplace: ">=3.0.0,<4.0.0"
      claudeup: ">=2.0.0,<3.0.0"
      claudish: ">=2.0.0,<3.0.0"
      compahook: ">=2.0.0,<3.0.0"

      # Cloud & Infrastructure
      cloud-tools: ">=3.0.0,<4.0.0"
      infra-tools: ">=3.0.0,<4.0.0"
      monitoring: ">=3.0.0,<4.0.0"

      # DevOps & Tools
      docker: ">=2.0.0,<3.0.0"
      github-cli: ">=3.0.0,<4.0.0"
      supabase-cli: ">=3.0.0,<4.0.0"
      tmux-workspace: ">=3.0.0,<4.0.0"

      # MCP Servers
      context7-mcp: ">=2.0.0,<3.0.0"
      excalidraw-mcp: ">=2.0.0,<3.0.0"
      jira-mcp: ">=3.0.0,<4.0.0"
      linear-mcp: ">=3.0.0,<4.0.0"
      pal-mcp-server: ">=10.0.0,<11.0.0"

      # Development Tools
      nodejs-devtools: ">=3.0.0,<4.0.0"

      # AI/ML Tools
      goose: ">=2.0.0,<3.0.0"
      ollama: ">=2.0.0,<3.0.0"

      # Desktop & UI
      guacamole: ">=3.0.0,<4.0.0"
      xfce-ubuntu: ">=3.0.0,<4.0.0"

      # Testing
      playwright: ">=3.0.0,<4.0.0"

      # Documentation & Content
      mdflow: ">=2.0.0,<3.0.0"
      spec-kit: ">=2.0.0,<3.0.0"

      # Productivity
      openskills: ">=3.0.0,<4.0.0"
      ralph: ">=2.0.0,<3.0.0"
      ruvnet-research: ">=2.0.0,<3.0.0"

    breaking_changes:
      - "Extension schema v2.0 (future) - major architectural changes"
      - "Placeholder for future breaking changes"

# Migration guide for v2.x to v3.x
migration_notes: |
  ## Migrating from Sindri v2.x to v3.x

  ### Extension Compatibility
  - All v2.x bash-based extensions must be upgraded to v3.x format
  - Run `sindri extension upgrade --all` to update compatible extensions
  - Extensions not yet updated for v3.x will show as incompatible

  ### Manifest Migration
  - The CLI will automatically migrate your ~/.sindri/manifest.yaml on first run
  - A backup will be created at ~/.sindri/manifest.yaml.v2.backup

  ### Breaking Changes
  1. Extension install methods have been standardized
  2. The 'manual' install method is removed - use 'script' instead
  3. Extension hooks now support pre/post lifecycle events
  4. Schema validation is now strictly enforced

  ### Recommended Actions
  1. Before upgrading: `sindri extension bom > extensions-backup.yaml`
  2. After upgrading: `sindri extension validate-all`
  3. Address any incompatible extensions
  4. Test your workflows in a non-production environment first

# Compatibility checking behavior
compatibility_rules:
  # Strict mode (default): Block upgrade if incompatible extensions found
  strict_mode: true

  # Allow --force to bypass compatibility checks (not recommended)
  allow_force_bypass: true

  # Auto-upgrade compatible extensions during CLI upgrade
  auto_upgrade_extensions: false

  # Warn about deprecated features
  warn_on_deprecated: true
