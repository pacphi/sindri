---
metadata:
  name: agentic-qe
  version: 1.0.0
  description: >-
    Agentic Quality Engineering v3 with AI-powered test generation,
    coverage analysis, and multi-agent workflows. Uses @agentic-qe/v3 package.
  category: dev-tools
  author: Sindri Team
  homepage: https://github.com/proffesor-for-testing/agentic-qe
  dependencies:
    - nodejs

requirements:
  domains:
    - registry.npmjs.org
    - github.com
    - api.anthropic.com
  diskSpace: 500
  memory: 512
  installTime: 120

install:
  method: mise
  mise:
    configFile: mise.toml
    reshimAfterInstall: true

configure:
  environment:
    - key: AQE_HOME
      value: $HOME/.agentic-qe
      scope: bashrc

validate:
  commands:
    - name: aqe
      versionFlag: --version
      expectedPattern: "3\\.\\d+\\.\\d+(-[a-z]+(\\.[0-9]+)?)?"
  mise:
    tools:
      - npm:@agentic-qe/v3
    minToolCount: 1

remove:
  confirmation: true
  mise:
    removeConfig: true
    tools:
      - npm:@agentic-qe/v3
  paths:
    - ~/.agentic-qe
    - ./.agentic-qe

upgrade:
  strategy: automatic
  mise:
    upgradeAll: true
    tools:
      - npm:@agentic-qe/v3

capabilities:
  # Project initialization capability
  project-init:
    enabled: true
    priority: 50
    commands:
      - command: "aqe init --auto"
        description: "Initialize Agentic Quality Engineering framework v3"
        requiresAuth: anthropic

    state-markers:
      - path: ".agentic-qe"
        type: directory
        description: "Agentic QE configuration directory"

    validation:
      command: "aqe --version"
      expectedPattern: "3\\.\\d+\\.\\d+(-[a-z]+(\\.[0-9]+)?)?"

  # Authentication requirements (requires Anthropic API for AI-powered test generation)
  auth:
    provider: anthropic
    required: true
    envVars:
      - ANTHROPIC_API_KEY
    validator:
      command: "claude --version"
      expectedExitCode: 0

  # Lifecycle hooks
  hooks:
    pre-install:
      command: "echo 'Preparing agentic-qe installation...'"
      description: "Pre-installation checks"
    post-install:
      command: "mise reshim && sleep 2"
      description: "Refresh shims after installation"
    pre-project-init:
      command: "echo 'Initializing agentic-qe project...'"
      description: "Pre-initialization setup"
    post-project-init:
      command: "true"
      description: "Post-initialization cleanup"

  # Collision handling for cloned projects
  collision-handling:
    enabled: true

    conflict-rules:
      - path: "CLAUDE.md"
        type: file
        on-conflict:
          action: append
          separator: "\n\n---\n\n"

      # Critical JSON merges
      - path: ".claude/mcp.json"
        type: file
        on-conflict:
          action: merge-json

      - path: ".claude/settings.json"
        type: file
        on-conflict:
          action: merge-json

      # Directory merge (remove backup: true since agentic-qe runs AFTER claude-flow)
      - path: ".claude"
        type: directory
        on-conflict:
          action: merge
          backup: false # claude-flow already created structure

    version-markers:
      # Agentic QE marker
      - path: ".agentic-qe"
        type: directory
        version: "installed"
        detection:
          method: directory-exists

    scenarios:
      # Scenario 1: Already installed
      - name: "already-initialized"
        detected-version: "installed"
        installing-version: "1.0.0"
        action: skip
        message: |
          âœ“ Agentic QE is already initialized

          To force a fresh installation, run:
            aqe init --yes --force

bom:
  tools:
    - name: agentic-qe
      version: dynamic
      source: npm
      type: framework
      license: MIT
      homepage: https://github.com/proffesor-for-testing/agentic-qe
      purl: pkg:npm/%40agentic-qe/v3
