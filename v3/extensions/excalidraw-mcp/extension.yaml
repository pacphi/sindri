metadata:
  name: excalidraw-mcp
  version: 1.0.0
  description: Real-time Excalidraw diagram creation and manipulation via MCP server
  category: mcp
  dependencies: [nodejs]

install:
  method: hybrid
  hybrid:
    steps:
      # Step 1: Install the npm package globally
      - method: npm-global
        npm:
          package: "mcp-excalidraw-server@latest"

      # Step 2: Pull the canvas Docker image
      - method: script
        script:
          path: scripts/install.sh
          args: []
          timeout: 300

requirements:
  domains:
    - registry.npmjs.org
    - ghcr.io
  diskSpace: 200
  memory: 512
  installTime: 120
  installTimeout: 300
  validationTimeout: 30
  secrets: []

validate:
  commands:
    - name: docker
      args: ["images", "ghcr.io/yctimlin/mcp_excalidraw-canvas"]
      expectedPattern: "mcp_excalidraw-canvas"
      description: "Verify canvas Docker image is pulled"

capabilities:
  project-init:
    enabled: true
    priority: 60
    commands:
      - command: "docker run -d -p 3000:3000 --name mcp-excalidraw-canvas --restart unless-stopped ghcr.io/yctimlin/mcp_excalidraw-canvas:latest"
        description: "Start Excalidraw canvas server in Docker"
        requiresAuth: "none"
        conditional: true
    state-markers:
      - path: ".excalidraw-mcp"
        type: directory
    validation:
      command: "docker ps --filter name=mcp-excalidraw-canvas --format '{{.Status}}'"
      expectedPattern: "Up"

  hooks:
    post-install:
      command: "docker pull ghcr.io/yctimlin/mcp_excalidraw-canvas:latest"
      description: "Ensure canvas image is up-to-date"

    post-project-init:
      command: "sleep 2 && curl -f http://localhost:3000/health || echo 'Canvas server starting...'"
      description: "Verify canvas server health"

  mcp:
    enabled: true
    server:
      command: "npx"
      args: ["-y", "mcp-excalidraw-server"]
      env:
        EXPRESS_SERVER_URL: "http://localhost:3000"
        ENABLE_CANVAS_SYNC: "true"
    tools:
      - name: "create_element"
        description: "Create a new element on the Excalidraw canvas"
      - name: "update_element"
        description: "Update an existing element"
      - name: "delete_element"
        description: "Delete an element from the canvas"
      - name: "query_elements"
        description: "Query elements on the canvas"
      - name: "get_resource"
        description: "Get canvas resources"
      - name: "batch_create_elements"
        description: "Create multiple elements at once"
      - name: "align_elements"
        description: "Align elements on the canvas"
      - name: "distribute_elements"
        description: "Distribute elements evenly"
      - name: "group_elements"
        description: "Group multiple elements together"
      - name: "ungroup_elements"
        description: "Ungroup elements"
      - name: "lock_elements"
        description: "Lock elements to prevent modification"
      - name: "unlock_elements"
        description: "Unlock elements"
      - name: "create_from_mermaid"
        description: "Convert Mermaid diagrams to Excalidraw format"

  project-context:
    enabled: true
    mergeFile:
      source: templates/SKILL.md
      target: CLAUDE.md
      strategy: append-if-missing

  collision-handling:
    enabled: true
    conflict-rules:
      - path: ".excalidraw-mcp"
        type: directory
        on-conflict:
          action: merge
          backup: false

configure:
  environment:
    - key: EXPRESS_SERVER_URL
      value: "http://localhost:3000"
      scope: session
      description: "URL for the Excalidraw canvas server"
    - key: ENABLE_CANVAS_SYNC
      value: "true"
      scope: session
      description: "Enable real-time canvas synchronization"

bom:
  tools:
    - name: mcp-excalidraw-server
      version: remote  # Tracks npm registry (@latest)
      source: npm
      type: server
      license: MIT

  docker:
    - image: ghcr.io/yctimlin/mcp_excalidraw-canvas
      version: latest
      purpose: "Canvas server for Excalidraw diagrams"
      license: MIT
docs:
  title: "Excalidraw MCP"
  overview: |
    The Excalidraw MCP extension enables AI agents to create, manipulate, and control diagrams on a live Excalidraw canvas in real-time. It combines an MCP server with a Docker-based canvas server to provide comprehensive diagramming capabilities through the Model Context Protocol.
  last-updated: "2026-02-09"
  features:
    - "13 MCP Tools - Complete CRUD operations, layout management, and diagram conversion"
    - "Docker-based Canvas - Containerized Excalidraw UI on port 3000"
    - "Real-time Sync - Live updates between MCP server and canvas"
    - "Mermaid Conversion - Import Mermaid diagrams as Excalidraw elements"
    - "Batch Operations - Efficient multi-element creation and manipulation"
    - "Auto-initialization - Automatic Docker container startup on project init"
  usage:
    - section: "Project Initialization"
      examples:
        - description: "Initialize a project with Excalidraw MCP"
          code: |
            sindri project init --extensions excalidraw-mcp
    - section: "Custom Port Configuration"
      examples:
        - description: "If port 3000 is unavailable"
          code: |
            # Start canvas on alternate port
            docker run -d -p 3001:3000 --name mcp-excalidraw-canvas \
              ghcr.io/yctimlin/mcp_excalidraw-canvas:latest

            # Update environment variable
            export EXPRESS_SERVER_URL=http://localhost:3001
    - section: "Docker Container Management"
      examples:
        - code: |
            # Check status
            docker ps --filter name=mcp-excalidraw-canvas

            # Start (if stopped)
            docker start mcp-excalidraw-canvas

            # Stop
            docker stop mcp-excalidraw-canvas

            # Restart
            docker restart mcp-excalidraw-canvas

            # View logs
            docker logs mcp-excalidraw-canvas
    - section: "Architecture Diagram Creation"
      examples:
        - description: "Common workflow for creating architecture diagrams"
          code: |
            # 1. Agent uses create_from_mermaid for initial structure
            # 2. Agent uses create_element for additional components
            # 3. Agent uses align_elements for clean layout
            # 4. Agent uses group_elements for logical grouping
            # 5. Agent uses lock_elements for finalized sections
    - section: "Troubleshooting"
      examples:
        - description: "Canvas not responding"
          code: |
            # Check container status
            docker ps --filter name=mcp-excalidraw-canvas

            # View logs for errors
            docker logs mcp-excalidraw-canvas

            # Restart container
            docker restart mcp-excalidraw-canvas
  related:
    - name: nodejs
      description: "Required for npm package installation"
    - name: claude-marketplace
      description: "For discovering additional MCP servers"
    - name: docker
      description: "Docker daemon management"
  notes: |
    After initialization, open your browser to http://localhost:3000 for a live view of all
    diagram operations. The container is configured with --restart unless-stopped, ensuring
    it survives Docker daemon restarts.

    MCP tools available: create_element, update_element, delete_element, query_elements,
    get_resource, batch_create_elements, align_elements, distribute_elements, group_elements,
    ungroup_elements, lock_elements, unlock_elements, create_from_mermaid.
