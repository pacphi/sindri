---
metadata:
  name: guacamole
  version: 2.0.0
  description: Apache Guacamole web-based remote desktop gateway (SSH/RDP/VNC)
  category: desktop
  author: Sindri Team
  homepage: https://guacamole.apache.org
  dependencies: []

requirements:
  domains:
    - apache.org
    - downloads.apache.org
    - archive.apache.org
    - archive.ubuntu.com
    - security.ubuntu.com
  diskSpace: 2000
  memory: 2048
  installTime: 180

install:
  method: script
  script:
    path: install.sh
    timeout: 1200
    args: ["--version", "1.5.4"]

configure:
  templates:
    - source: guacamole.properties.template
      destination: /etc/guacamole/guacamole.properties
      mode: overwrite
    - source: user-mapping.xml.template
      destination: /etc/guacamole/user-mapping.xml
      mode: overwrite
  environment:
    - key: GUACAMOLE_HOME
      value: "/etc/guacamole"
      scope: bashrc
    - key: CATALINA_HOME
      value: "/usr/share/tomcat9"
      scope: bashrc

validate:
  commands:
    - name: guacd
      versionFlag: "--version"
      expectedPattern: "guacd version \\d+\\.\\d+\\.\\d+"
    - name: java
      versionFlag: "-version"
      expectedPattern: "version"

remove:
  confirmation: true
  mise:
    removeConfig: true
    tools: [tomcat]
  script:
    path: uninstall.sh
    timeout: 120

upgrade:
  strategy: manual
  script:
    path: upgrade.sh
    timeout: 600

bom:
  tools:
    - name: guacd
      version: "1.5.4"
      source: binary
      type: server
      license: Apache-2.0
      homepage: https://guacamole.apache.org
      purl: pkg:generic/guacamole-server@1.5.4
    - name: guacamole-client
      version: "1.5.4"
      source: binary
      type: framework
      license: Apache-2.0
      homepage: https://guacamole.apache.org
      purl: pkg:maven/org.apache.guacamole/guacamole@1.5.4
    - name: tomcat
      version: "9.x"
      source: mise
      type: server
      license: Apache-2.0
      homepage: https://tomcat.apache.org
      purl: pkg:generic/tomcat@9
  files:
    - path: /etc/guacamole/guacamole.properties
      type: config
    - path: /etc/guacamole/user-mapping.xml
      type: config
    - path: /var/lib/tomcat9/webapps/guacamole.war
      type: binary
docs:
  title: "Guacamole"
  overview: |
    Apache Guacamole web-based remote desktop gateway. Provides browser-based access to SSH, RDP, and VNC connections.
  last-updated: "2026-01-26"
  features:
    - "Web-based - Access from any browser"
    - "Multi-protocol - SSH, RDP, VNC support"
    - "No client needed - HTML5 based"
    - "Session recording - Optional recording"
    - "Authentication - Multiple auth methods"
  usage:
    - section: "Accessing Guacamole"
      examples:
        - code: |
            # Default URL after installation
            # http://localhost:8080/guacamole

            # Default credentials (change immediately!)
            # Username: admin
            # Password: admin
    - section: "Connection Configuration"
      examples:
        - code: |
            <!-- /etc/guacamole/user-mapping.xml -->
            <user-mapping>
                <authorize username="admin" password="admin">
                    <connection name="SSH Server">
                        <protocol>ssh</protocol>
                        <param name="hostname">192.168.1.100</param>
                        <param name="port">22</param>
                        <param name="username">user</param>
                    </connection>
                    <connection name="Windows RDP">
                        <protocol>rdp</protocol>
                        <param name="hostname">192.168.1.101</param>
                        <param name="port">3389</param>
                    </connection>
                </authorize>
            </user-mapping>
    - section: "Service Management"
      examples:
        - code: |
            # Start guacd daemon
            sudo systemctl start guacd

            # Start Tomcat
            sudo systemctl start tomcat9

            # Check status
            sudo systemctl status guacd
            sudo systemctl status tomcat9

            # View logs
            sudo journalctl -u guacd
            sudo tail -f /var/log/tomcat9/catalina.out
    - section: "Configuration Files"
      examples:
        - code: |
            # Main configuration
            sudo vim /etc/guacamole/guacamole.properties

            # User authentication
            sudo vim /etc/guacamole/user-mapping.xml

            # Guacd configuration
            sudo vim /etc/guacamole/guacd.conf
  related:
    - name: xfce-ubuntu
      description: "XFCE desktop for Guacamole RDP access"
